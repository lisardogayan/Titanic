
---
title: "Practica 2: Análisis descriptivo e inferencial"
author: 
- "José Luis Melo"
- "Lisardo Gayán Tremps"
date: '`r format(Sys.Date(),"%e %B, %Y")`'
output:
  pdf_document:
    highlight: default
    number_sections: no
    toc: yes
    toc_depth: 3
  html_document:
    highlight: default
    number_sections: no
    theme: cosmo
    toc: yes
    toc_depth: 3
    toc_float: yes
---
```{r  Librerias}
library(kableExtra)
library(ggplot2)
library(dplyr)
```


# 1 - Descripción del dataset. ¿Por qué es importante y qué pregunta/problema pretende responder?

El dataset de Titanic: Machine Learning from Disaster se registran los datos de los pasajeros del famoso trasatlantico y se utiliza para predecir los sobrevivientes. Los datos estan divididos en dos dataset, uno de test y otro entrenamiento, para la creación de modelos de predicción.

# 2 - Integración y selección de los datos de interés a analizar

Siendo los dataset relativamente pequeños (dataset de test 418 observaciones y 11 variables, dataset de train 891 y 12 variables), con solo 1309 observaciones y 11 variables, se importaran en su totalidad para la realización de esta practica. Inicialmente no se importara la variable survived del dataset de train. 
A continuacion se importan, fusionan los datos y se revisa la estructura inicial de los datos.  

```{r Importacion datos}
datostest <- read.csv ("./data/test.csv", stringsAsFactors = F)
datostrain <- read.csv("./data/train.csv", stringsAsFactors = F)
datostrain1 <- datostrain[,-2]

data <- rbind(datostrain1, datostest) # Fusion datasets
str(data)
```

A continuación se detallan las variables y su tipo inicial, este ultimo,se modificara para su mejor analisis. 

```{r Tipos de Variables Original}
tipos <- sapply(data, class)
kable(data.frame(Variables = names(tipos), Tipo_Variable= as.vector(tipos))) %>%
  kable_styling(bootstrap_options = "striped", full_width = F, position = "left")
```
De las variables, se convertiran a entero la edad y a factor las siguientes variables Pclass, Sex, Cabin y Embarked.

```{r Conversion Variables}
data$Age <- as.integer(data$Age)
data$Pclass <- as.factor(data$Pclass)
data$Sex <- as.factor(data$Sex)
data$Embarked <- as.factor(data$Embarked)
data$Cabin <- as.factor(data$Cabin)

tipos_new <- sapply(data, class)
kable(data.frame(Variables = names(tipos_new), Tipo_Variable= as.vector(tipos_new))) %>%
  kable_styling(bootstrap_options = "striped", full_width = F, position = "left")
```

Una vez modificadas los tipos de valores se resume que
```{r Resumen Variables}
summary(data)
```

PassengerId: Variable de tipo entero que contiene el id del pasajero, no existen valores nulos o perdidos.  
Pclass: Variable de tipo factor con la categoria asignada al pasajero, no existen valores nulos o perdidos.  
Name: Variable de tipo texto con el nombre del pasajero, no existen valores nulos o perdidos.  
Sex: Variable de tipo factor con el genero del pasajero, no existen valores nulos o perdidos.  
Age: Variable de tipo entero que especifica la edad del pasajero, **existen 263 valores nulos.**  
SibSp: Variable de tipo entero que especifica el numero de hermanos/esposa abordo, no existen valores nulos o perdidos.  
Parch: Variable de tipo entero que especifica el numero de padres/hijos abordo, no existen valores nulos o perdidos.  
Ticket: Variable de tipo texto que indica el numero de ticket, no existen valores nulos o perdidos.   
Fare: Variable de tipo numero que especifica la tarifa pagada, **existe 1 valor nulo.**   
Cabin: Variable de tipo factor donde se especifica la cabina asignada, **existen 1014 valores perdidos.**   
Embarked: Variable de tipo factor que indica el puerto de embarque, **existen 2 valores perdidos.**    
  
# 3 - Limpieza de datos

## 3.1. ¿Los datos contienen ceros o elementos vacíos? ¿Cómo gestionarías cada uno de estos casos?
  
De las variables existentes a continuación se espedifican aquellas que contienen valores perdido o nulos.  

Age: *existen 263 valores nulos.*  

"Para imputar valores **edad**, (analizando si es mejor imputar mediante la media de los valores, rpart o mice)"

http://jstatsoft.org/article/view/v045i03  
Data Analysis with R,  A comprehensive guide to manipulating, analyzing and visualizing data in R
Pag 373 - 386 
```{r Confirmación nulos age}
sum(is.na(data$Age))     ## Realiza el conteo de valores NA de la variable Age
``` 

Fare: *existe 1 valor nulo.*     
Para imputar valores **Fare**  
Dado que unicamente hay un valor perdido, es posible imputarlo por la media en base al puerto de embarque "S" y la clase "3"

```{r Confirmación nulos Fare}
sum(is.na(data$Fare))    ## Realiza el conteo de valores NA de la variable Fare

M_fare<- subset(data,data$Pclass == '3' & data$Embarked == 'S')
median(M_fare$Fare, na.rm = T)

ggplot(M_fare,  aes(x = Fare)) +
  geom_density(fill = 'grey', alpha=0.4) + 
  geom_vline(aes(xintercept=median(Fare, na.rm=T)),
    colour='blue', linetype='dashed', lwd=1) 
``` 

La tarifa de 80 coincide con la media de los pasajeros de primera clase que embarcaron en C, por lo que se podría imputar este puerto. 

```{r Imputacion Fare}
data$Fare[c(1044)] <- 80
```



Cabin: *existen 1014 valores perdidos.*     
Para imputar valores **Cabin**  
Esta variable tiene muchos valores perdidos, se podria conseguir predecir la cubierta asignada al pasajero pero es un dato que poco beneficio podría traer ya que se puede realizar el analisis con la combinación entre la tarifa y la clase del pasajero.  

```{r Confirmación nulos Cabin}
sum(data$Cabin=="")      ## Realiza el conteo de valores vacios de la variable Cabin
```

Embarked: *existen 2 valores perdidos.*      
Para imputar valores **Embarked**  
Al ser unicamente dos valores perdidos, se podría sustituir los valores por la media, en base a otros pasajeros de la misma clase y puerto de embarque. 
Los pasajeros han pagado una tarifa de 80 y pertenecian a primera clase. 

```{r}
data[(data$Embarked==""),]
embarco <- data %>%
  filter(PassengerId != 62 & PassengerId != 830)

ggplot(embarco, aes(x = Embarked, y = Fare, fill = factor(Pclass))) +
  geom_boxplot() +
  geom_hline(aes(yintercept=80), 
    colour='blue', linetype='dashed', lwd=1) 

```

La tarifa de 80 coincide con la media de los pasajeros de primera clase que embarcaron en C, por lo que se podría imputar este puerto. 

```{r Imputacion Embarco}
data$Embarked[c(62, 830)] <- 'C'
```

## 3.2. Identificación y tratamiento de valores extremos. 

  
```{r Valores Extremos}
##par(mfrow=c(1,3))
##age.bp <- boxplot(data$Age, main= "Edad")
##hist (data$Age, main = "Dist. Edad")

```